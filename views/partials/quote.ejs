<!DOCTYPE html>
<div class="jumbotron">
    <div class="container">
        <div class="col-xs-offset-2 col-xs-8">
			<div ng-controller="quoteCtrl" ng-init='customer=<%- JSON.stringify(customer) %>;quote=<%- JSON.stringify(quote) %>; materials=<%- JSON.stringify(materials) %>; products=<%- JSON.stringify(products) %>; addCounter == false'>
				<form name="quoteForm">
					Customer: {{customer.lastName}}, {{customer.firstName}}
					<br>QuoteID: {{quote.quoteID}}
					<br>
					<br>
				Quote Description:
					<br>
					<textarea rows="4" columns="150" ng-model="quote.description"></textarea>
					<br>
					<div ng-show="addCounter == true">
						<ng-form name="addCounterForm">
							Counter Shape: 
							<br>
							<select name="shape" ng-model="shape" convert-to-number id="shape">
								<option value="" selected='selected'>----Select----</option>
								<option  value="rectangle">Rectangle</option>
								<option value="circle">Circle</option>
							</select>
							<br>
							<div ng-show="shape == 'rectangle' || shape == 'circle'">
								Width in inches: <input type="text" ng-model="counterWidth" name="counterWidth">
							</div>
							<br>
							<div ng-show="shape == 'rectangle'">
								Length in inches: <input type="text" ng-model="counterLength" name="counterLength">
							</div>
							<br>
							<div ng-show="shape == 'rectangle' || shape == 'circle'">
								<br>
								Choose a Distributor: <select name="materialDistributor" ng-model="materialDistributor" ng-options="material.distributor for material in materials | orderBy:'distributor' | unique: 'distributor'">
								<option value="">----Select----</option>
								</select>
								<br>
								<div ng-show="materialDistributor">
									<br>
									Choose a Manufacturer:
									<select name="materialManufacturer" ng-model="materialManufacturer" ng-options="material.manufacturer for material in materials | filter:{distributor:materialDistributor.distributor} | unique: 'manufacturer' | orderBy:'manufacturer'">
										<option value="">----Select----</option>
									</select>
								</div>
								<div ng-show="materialDistributor && materialManufacturer">
									<br>
									Choose a Colour Group:
									<select name="materialColourGroup" ng-model="materialColourGroup" ng-options="material.colourGroup for material in materials | filter:{distributor:materialDistributor.distributor, manufacturer:materialManufacturer.manufacturer} | unique: 'colourGroup' | orderBy:'colourGroup'">
										<option value="">----Select----</option>
									</select>
								</div>
								<div ng-show="materialDistributor && materialManufacturer && materialColourGroup">
									<br>
									Choose a Colour Description:
									<select name="materialDescription" ng-model="materialDescription" ng-options="material.description for material in materials | filter:{distributor:materialDistributor.distributor, manufacturer:materialManufacturer.manufacturer, colourGroup:materialColourGroup.colourGroup} | unique: 'description' | orderBy:'description'">
										<option value="">----Select----</option>
									</select>
								</div>
								<div ng-show="materialDistributor && materialManufacturer && materialColourGroup && materialDescription">
								<br>
								<ul class="list-group"> 
									<li class="list-group-item">	
										Item Code: {{materialDescription.itemCode}} <br> 
									</li>	
									<li class="list-group-item">	
										Thickness: {{materialDescription.thickness}} <br> 
									</li>	
									<li class="list-group-item">	
										Width (In.): {{materialDescription.width}} <br> 
									</li>				
									<li class="list-group-item">	
										Length (In.): {{materialDescription.length}} <br> 
									</li>	
									<li class="list-group-item">	
										Full Sheet 1-5: {{materialDescription.fullSheet1}} <br> 
									</li>	
									<li class="list-group-item">	
										Half Sheet: {{materialDescription.halfSheet}} <br> 
									</li>
									<li class="list-group-item">	
										Full Sheet 5-20:{{materialDescription.fullSheet5}} <br> 
									</li>
									<li class="list-group-item">	
										Full Sheet 21+: {{materialDescription.fullSheet21}} <br> 
									</li>
									<li class="list-group-item">	
										ISA: {{materialDescription.isa}} <br> 
									</li>
									<li class="list-group-item">	
										Collection: {{materialDescription.matCollection}} <br> 
									</li>
								</ul>
							</div>
						</div>
						</ng-form>
					</div>
					<br>
					<div ng-show="addCounter == true">
						<button type="button" style="btn" ng-click="hideCounter()">Cancel</button>
						<span ng-show="materialDistributor && materialManufacturer && materialColourGroup && materialDescription"><button type="button" style="btn" ng-click="saveCounter(quote, counterWidth, counterLength, shape, materialDescription, materials)">Save Table</button></span>
					</div>
					<div ng-hide="addCounter == true">
						<button type="button" style="btn" ng-click="showCounter()">Add a Counter</button>
					</div>
					<br><br>
					<div ng-repeat="counter in quote.counters">
				  		<u>Counter {{$index + 1}}</u> <button type="button" style="btn btn-danger" ng-click="deleteTable(quote, $index)">DELETE THIS COUNTER</button>
						<br><br>
						Counter Description:
						<br><textarea rows="4" columns="150" ng-model="counter.description"></textarea>
						<br>
						<br>Addons: 
						<br>Choose a Distributor:
						<select name="counterAddonDistributor" ng-model="counterAddonDistributor" ng-options="product.distributor for product in products | filter:{category: '!mandatory'} | unique: 'distributor' track by product.distributor">
							<option value="">----Select----</option>
						</select>
						<br>
						<div ng-show="counterAddonDistributor">
							<br>
							Choose a Manufacturer:
							<select name="counterAddonManufacturer" ng-model="counterAddonManufacturer" ng-options="product.manufacturer for product in products | filter:{distributor:counterAddonDistributor.distributor} | unique: 'manufacturer' | orderBy:'manufacturer'">
								<option value="">----Select----</option>
							</select>
						</div>
						<div ng-show="counterAddonDistributor && counterAddonManufacturer">
							<br>
							Choose a Product Type:
							<select name="counterAddonType" ng-model="counterAddonType" ng-options="product.type for product in products | filter:{distributor:counterAddonDistributor.distributor, manufacturer:counterAddonManufacturer.manufacturer} | unique: 'type' | orderBy:'type'">
								<option value="">----Select----</option>
							</select>
						</div>
						<div ng-show="counterAddonDistributor && counterAddonManufacturer && counterAddonType">
							<br>
							Choose a Description:
							<select name="counterAddonDescription" ng-model="counterAddonDescription" ng-options="product.description for product in products | filter:{distributor:counterAddonDistributor.distributor, manufacturer:counterAddonManufacturer.manufacturer, type:counterAddonType.type} | unique: 'description' | orderBy:'description'">
								<option value="">----Select----</option>
							</select>
						</div>
						<div ng-show="counterAddonDistributor && counterAddonManufacturer && counterAddonType && counterAddonDescription">
							<br>
							<ul class="list-group"> 
								<li class="list-group-item">	
									Item Code: {{counterAddonDescription.itemCode}}<br> 
								</li>	
								<li class="list-group-item">	
									Price: {{counterAddonDescription.price}}<br> 
								</li>	
								<li class="list-group-item">	
									Formula: {{counterAddonDescription.formula}}
								</li>
								<li ng-show="counterAddonDescription.formula=='item'" class="list-group-item">	
									Quantity: <input type="text" ng-model="counterAddonDescription.quantity">
									<br>
								</li>
								
							</ul>
						    <button type="button" ng-click="saveAddon(quote, counterAddonDescription, $index)" class="btn btn-default">Add</button>
						    <button type="button" ng-click="hideAddons($index)" class="btn btn-danger">Cancel</button> 
						</div>
						<br>----------
						<br>Mandatory charges:
						<br>
						<div ng-repeat="charge in counter.mandatoryCharges">
							<ng-form name="mandatoryMaterialsForm">
								<br>{{charge.material}} - {{charge.price | currency:$}}/{{charge.unitOfMeasure}}
								<br>Quantity: <input ng-change="mandatoryChargeChange(charge.material, charge.price, charge.quantity, quote, counter, $parent.$index, $index)" type="number" ng-model="charge.quantity"> Total: {{charge.totalPrice |currency:$}}
							</ng-form>
						</div>
						<br>
						<u>Summary</u>: 
				  		<br>
				  		<br>Counter Shape: {{counter.counterShape}} 
				  		<br>Counter Width: {{counter.counterWidth}}
				  		<span ng-show="counter.counterShape==='rectangle'"><br>Counter Length: {{counter.counterLength}}</span>
				      	<br>Counter Colour Group: {{counter.material.colourGroup}}
				      	<br>Counter Material: {{counter.material.description}}
				      	<br>Counter Price/Sheet: {{counter.material.price | currency:$}}
				      	<br>
				      	<br><u>Select Addons:</u> 
						<br>
						<div ng-repeat="addon in counter.addons">
							<br>{{addon.type}} - {{addon.description}} : {{addon.quantity}}@{{addon.price | currency:$}} <a href="#" ng-click="removeAddon(addon, $parent.$index, $index, quote)">remove</a>
						</div>

				      	<br><hr style="background:#000000; border:0; height:7px" />

				      	<span style="float: left;">Counter Subtotal: {{counter.totalPrice |currency:$}}</span><span style="float: right;"><button type="button" style="btn" ng-click="saveQuote(quote, quote.description)">Update/Save Quote</button></span>
				      	<br>
				      	<!--<br>counter Thickness: {{counter.counterThickness1}}
				      	<br>counter Thickness 2: {{counter.counterThickness1}}-->
				      	<hr style="background:#FFFFFF; border:0; height:7px" />
					</div>
					<br>Job Difficulty: <input type="number" ng-model="quote.jobDifficulty" name="quote.jobDifficulty"><br>
					<span style="float: left;">Total Price: {{quote.totalPrice * quote.jobDifficulty | currency:$}}</span>
					<span style="float: right;"><button type="button" style="btn" ng-click="saveQuote(quote, quote.description)">Update/Save Quote</button></span>
				</form>
				<br><br>
				Please click <a ng-href="/customer/{{customer.custCode}}/quote/{{quote.quoteID}}/invoice">here</a> to view the invoice.
				<br>
				<alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>
				<br><br><br>
			</div>
        </div>
    </div>
</div>
<!--
List of things I would like to add:
Dynamic ul's for item code, thickness, etc. if they're empty, they don't show up

-->